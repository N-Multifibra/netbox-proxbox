{% extends 'base/layout.html' %}
{% load static %}

{% block head %}
    <script
        src="https://unpkg.com/htmx.org@2.0.4"
        integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
        crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/htmx-ext-ws@2.0.1/ws.js"></script>
{% endblock %}
{% block content %}
    <div>
        <div class="row mb-3">

            <div align=center id="full-update-error-message"></div>
            {# Full Update Button#}
            <div style="margin-bottom: 15px;" class="d-flex justify-content-center noprint">
                <form class="m-2" action="">
                    {% if perms.netbox_proxbox.add_proxmoxvm %}
                        <button 
                            id="full-update-button"
                            class="btn btn-primary"
                            hx-connect='{{ fastapi_ws_endpoint }}'
                            ws-send='Start'
                            hx-trigger="click"
                        >Proxmox Full Update</button>
                    {% endif %}
                </form>
                <form class="m-2" action="" onsubmit="syncNodes(event)">
                    {% if perms.netbox_proxbox.add_proxmoxvm %}
                        <button id="full-update-button" class="btn btn-primary">Sync Nodes</button>
                    {% endif %}
                </form>
                <form class="m-2" action="" onsubmit="syncVirtualMachines(event)">
                    {% if perms.netbox_proxbox.add_proxmoxvm %}
                        <button id="full-update-button" class="btn btn-primary">Sync Virtual Machines</button>
                    {% endif %}
                </form>
            </div>
            <br>
            <br>

            <div class="d-flex justify-content-center flex-nowrap" style="margin-bottom: 15px;">
                <h2>
                    Proxbox Configuration
                </h2>
            </div>
         
            {# Netbox Card #}
            {% for object in netbox_endpoint_list %}
                {% include "netbox_proxbox/home/netbox_card.html" %}
            {% endfor %}
            
            {# FastAPI Card #}
            {% for object in fastapi_endpoint_list %}
                {% include "netbox_proxbox/home/fastapi_card.html" %}
            {% endfor %}

            {# Proxmox Card #}
            {% for object in proxmox_endpoint_list %}
                {% include "netbox_proxbox/home/proxmox_card.html" %}
            {% endfor %}
            
        </div>

        {% include "netbox_proxbox/home/log_messages.html" %}
    </div>
{% endblock %}

{% block footer_links %}
    {{ block.super }}

    {% include "netbox_proxbox/footer.html" %}
{% endblock %}